<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">


    <title> Misc.py </title>
    <!-- Bootstrap core CSS -->
    <link href="http://localhost:5000/static/css/bootstrap.min.css" rel="stylesheet">

<script src="CodeMirror-master/lib/codemirror.js"></script>
<link rel="stylesheet" href="CodeMirror-master/lib/codemirror.css">
<link rel="stylesheet" href="CodeMirror-master/theme/blackboard.css">
<script src="CodeMirror-master/mode/python/python.js"></script>
<!--<script src="CodeMirror-master/mode/javascript/javascript.js"></script>-->
<script>
var cm;
window.onload=function () {

cm=CodeMirror.fromTextArea(document.getElementById('codepad'), {
    mode: "python",
    theme: "blackboard",
    lineNumbers: true 
  });
cm2=CodeMirror.fromTextArea(document.getElementById('codepad2'), {
    mode: "python",
    theme: "blackboard",
    lineNumbers: true 
  });
cm3=CodeMirror.fromTextArea(document.getElementById('codepad3'), {
    mode: "python",
    theme: "blackboard",
    lineNumbers: true 
  });
};
</script>
  </head>
  <body >
<nav class="navbar navbar-default" style="border-style:solid;border-bottom-width:1px;border-bottom-color:#eee" id='navBar'>
 
  </nav>
  <div class="container">
    <div class="row">
          <div class="col-md-3" id="left_menu">
         
        </div>
      <div class="col-md-9">
      <h1>
        ¶ Generating API
      </h1><br>
        API's allows us to access data and services of a software. Misc also comes with a quick command line to generate a named api.
        It would create a controller and model around it.<br>
        <div class="alert alert-warning">python generate.py api api_name atrrib1 attrib2 </div><br>
        To execute the command you must be at the root directory of the project.

        <h2>TODO App</h2>

        We will create one controller/model for our TODO app. Task will be simple , just adding task and due date for the same

        <div class="alert alert-warning">
          python generate.py api todo title text  <br>
        </div>

        You can clearly see in <code>/controllers</code> , TodoController has been created followed by its model name
        in <code>/models</code> directory.
        Also all attributes that we have created has also been created.

        <h3>¶  CRUD for TODO app </h3>
        
        <table class="table table-striped"> 
          <tr><th>Request Type</th><th>URL</th><th>Parameter</th><th>Text</th></tr>
          <tr><td>POST</td><td>/todo</td><td>{ "text" : "clean all furnitures" , "title" : "furniture cleaning" }</td><td> add todo text</td></tr>
          <tr><td>GET</td><td>/todo/&lt;id&gt;</td><td> </td><td>Get TODO By Id</td></tr>
          <tr><td>DELETE</td><td>/todo/&lt;id&gt;<id></td><td> </td><td>Delete TODO by id</td></tr>
        </table>
        <h3> Routes </h3>
        We will be creating 3 routes for our above operations.
        Locate routes in <code>config/routes.py</code>
        Each route has request type corresponding TodoController that will get the request and forward it to Todo model<br><br>
 <textarea id="codepad">
from api.controllers import TestController
from api.controllers import TodoController
methods = {

  'GET  /'   :  TestController.test,

  'POST /todo'  : TodoController.add,

  'GET /todo/<id>' : TodoController.get,

  'DELETE /todo/<id>' : TodoController.delete  

  }
</textarea><br>
  
  <h3>TodoController.py</h3>
  Now we will be writing the functions in our controller to handle the request made on the routes.
  We will write 3 functions one to accept data , other two to fetch and delete data.

  <textarea id="codepad2">
from api.models import Todo
from api.responses import  req, res

def add():
  if req.body('title') == None or req.body('text') == None:
    return res.badRequest( "Missing Parametes" )

  result = Todo.add( req.body() ) 
  if result is not None:
    return res.dump({ "message" : "successfully added" , "data" : result })

  return res.negotiate({"message"  : "something went wrong" })

def get( id ):
  result = Todo.get(id)
  return res.dump({ "message" : result } )

def delete( id ):
  result = Todo.delete(id)
  return res.dump({ "message" : result })
  </textarea>
  <br>
 Line 5-6 verifies if <code>"title"</code> and <code>"text"</code> is not being sent from the user  , in case not found
 it returns with a bad request as a response else it will be forwarded to the models     
 <br>

 <h3>Todo.py</h3>
 Our Model is going to communicate to our database by receiving data from the controller and passing it back with/without data. 
 For our functions defined in controller we will have corresponding functions.
 <textarea id="codepad3">
from config import Misc
modelAttributes = {
        'title':  { 'type' : str, 'strict' : True },
        'text':  { 'type' : str, 'strict' : True },
      }

TodoTable = Misc.mongo['Todo']

def add( data ):
  todo_id = TodoTable.insert( data )
  return todo_id

def get( id ):
  return TodoTable.find_one({ "_id" : Misc.ObjectId( id )  })

def delete( id ):
  action = TodoTable.delete_one({ "_id" : Misc.ObjectId( id ) })
  if action is not None:
    return "deleted"
  return "err deleting"
 </textarea>
<br><br>


    </div>
  </div>
  <script type="text/javascript" src="/static/js/autofill.js"></script>
  </body>
</html>